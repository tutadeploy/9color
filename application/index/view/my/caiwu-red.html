<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>账户明细</title>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
	<meta name="renderer" content="webkit" />
	<meta name="viewport"
		content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
	<meta name="format-detection" content="telephone=no" />
	<link rel="stylesheet" href="/static/home/css/style.css" />

	<script src="/static/home/js/jquery.js"></script>
	<script src="/static/home/js/lib.js"></script>
	<style>
		.pagination {
			display: flex;

		}
	</style>
</head>

<body>
	<div class="header header3">
		<a href="/my" class="g-return"></a>
		<h1>账户明细</h1>
	</div>
	<div class="lc-box1 mx-box1">
		<div class="form-date">
			<input type="hidden" value="" id="type">
			<form>
				<input type="text" id="start" class="inp" name="start" value="" />
				<strong>至</strong>
				<input type="text" id="end" class="inp" name="end" value="" />
				<input type="submit" value="搜索" class="submit">
			</form>
		</div>
	</div>
	<div class="wp">
		<ul class="z-tab TAB_CLICK">
			<li class="<?php echo !$type?'on':'';  ?>"><a href="/my/caiwu">所有类型</a></li>
			<li class="<?php echo $type == 1?'on':'';  ?>"><a href="/my/caiwu.html?type=7">提现记录</a></li>
			<li class="<?php echo $type == 2?'on':'';  ?>"><a href="/my/caiwu.html?type=1">充值记录</a></li>
		</ul>
		<ul class="mx-list" id="newsList">


		</ul>
	</div>
	<div class="loadmore" id="moreNews" onclick="moreNews()">查看更多</div>

	<link rel="stylesheet" href="/static/home/css/weui.min.css">
	<link rel="stylesheet" href="/static/home/css/jquery-weui.css">
	<script src="/static/home/js/jquery-weui.js"></script>
	<script>
		var date = new Date();
		var year = date.getFullYear();
		var month = date.getMonth() + 1;
		var day = date.getDate();
		month = (month > 9) ? month : ('0' + month);
		day = (day < 10) ? ('0' + day) : day;

		var today = year + '-' + month + '-' + day;
		var start = $("#start").val();
		var end = $("#end").val();


		// start = start==''? today :  start;
		// end = end==''? today :  end;


		$(function () {
			$("#start").datetimePicker({
				title: '选择日期',
				value: start,
				yearSplit: '-',
				monthSplit: '-',
				times: function () {
					return [
					];
				},
				onChange: function (picker, values, displayValues) {
					console.log(values);
				}
			});
			$("#end").datetimePicker({
				title: '选择日期',
				value: end,
				yearSplit: '-',
				monthSplit: '-',
				times: function () {
					return [
					];
				},
				onChange: function (picker, values, displayValues) {
					console.log(values);
				}
			});
		})


		var pageNo = 1;

		$(function () {
			ajaxHonor(pageNo, 20);
		})

		function moreNews() {
			pageNo++;
			ajaxHonor(pageNo, 20);
		}

		function ajaxHonor(page, limit) {
			//提交 Ajax 成功后，静态更新表格中的数据
			$.ajax({
				url: '/balance-log/page',
				method: 'get',
				data: {
					pageNo: page,
					pageSize: limit,
					type: $("#type").val(),
					startTime: $("#start").val(),
					endTime: $("#end").val()
				},
				dataType: "json",
				success: function (res) {
					console.log(res);
					if (res.success) {
						initHtml(res.data.records, res.data.current >= res.data.pages);
					}
				}
			});
		}
		function timestampToTime(timestamp) {
			var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
			var Y = date.getFullYear() + '年';
			var M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '月';
			var D = (date.getDate() < 10 ? '0' + date.getDate() : date.getDate()) + '日 ';
			var h = (date.getHours() < 10 ? '0' + date.getHours() : date.getHours()) + ':';
			var m = (date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes()) + ':';
			var s = date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds();
			return Y + M + D + h + m + s;
		}

		function initHtml(newsList, hideBtn) {
			var html = "";
			if (hideBtn) {
				$("#moreNews").remove();
			}

			for (var i = 0; i < newsList.length; i++) {
				var obj = newsList[i];

				var statusHtml = '';

				switch (obj.type) {
					case 17:
						statusHtml = '<font color="red">提现驳回</font>';
						break;
					case 11:
						statusHtml = '<font color="red">商城支出</font>';
						break;
					case 1:
						statusHtml = '<font color="red">用户充值</font>';
						break;
					case 2:
					case 4:
						statusHtml = '<font color="#2a28c3">用户接单</font>';
						break;
					case 3:
						statusHtml = '<font color="red">接单返佣</font>';
						break;
					case 6:
						statusHtml = '<font color="#0cea5b">下级返佣</font>';
						break;
					case 7:
						statusHtml = '<font color="#d814c9">用户提现</font>';
						break;
					case 21:
						statusHtml = '<font color="red">余额宝转入</font>';
						break;
					case 22:
						statusHtml = '<font color="red">余额宝转出</font>';
						break;
					case 23:
						statusHtml = '<font color="red">余额宝收益</font>';
						break;
					case 24:
						statusHtml = '<font color="red">余额宝手续费</font>';
						break;
					case 25:
						statusHtml = '<font color="red">升级VIP</font>';
						break;
				}

				var flag = "+";
				switch (obj.type) {
					case 11:
					case 2:
					case 4:
					case 7:
					case 21:
					case 24:
					case 25:
						flag = "-"
						break;
				}




				html += '<li>' +
					'<div class="txt">' +
					'<div class="s1">' +
					statusHtml +
					'</div>' +
					'<div class="s2">' + timestampToTime(obj.createTime) + '</div>' +
					'</div>' +
					'<div class="price">' +
					flag + obj.num.toFixed(2) +
					'</div>' +
					'</li>';

			}

			$("#newsList").append(html);
		}


	</script>
</body>

</html>