# DNSæ±¡æŸ“åœºæ™¯ä¸‹çš„åŸŸååˆ‡æ¢åˆ†æ

## âŒ å…³é”®æŠ€æœ¯æŒ‘æˆ˜

### æ‚¨çš„é—®é¢˜éå¸¸å‡†ç¡®ï¼

**é—®é¢˜åœºæ™¯ï¼š**
```yaml
æƒ…å†µ: AåŸŸåè¢«DNSæ±¡æŸ“
ç”¨æˆ·è®¿é—®: AåŸŸå â†’ DNSè¿”å›é”™è¯¯IP â†’ è¿æ¥åˆ°é”™è¯¯æœåŠ¡å™¨
ç»“æœ: æˆ‘ä»¬çš„JavaScriptä»£ç æ— æ³•æ‰§è¡Œï¼
```

**æ ¸å¿ƒé—®é¢˜ï¼š**
- å¦‚æœç”¨æˆ·è¿æ¥åˆ°çš„ä¸æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬çš„åˆ‡æ¢ä»£ç å°±ä¸ä¼šè¿è¡Œ
- DNSæ±¡æŸ“ä¼šè®©ç”¨æˆ·"è¿·è·¯"ï¼Œæ ¹æœ¬åˆ°ä¸äº†æˆ‘ä»¬çš„æœåŠ¡å™¨

---

## ğŸ” DNSæ±¡æŸ“çš„å…·ä½“å½±å“

### æ­£å¸¸æƒ…å†µ vs DNSæ±¡æŸ“æƒ…å†µ

#### âœ… æ­£å¸¸æƒ…å†µ
```
ç”¨æˆ·è®¿é—® domain-a.com
     â†“
DNSè§£æ: domain-a.com â†’ 1.2.3.4 (æˆ‘ä»¬çš„æœåŠ¡å™¨)
     â†“
è¿æ¥åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼ŒåŠ è½½ç½‘é¡µ
     â†“
æˆ‘ä»¬çš„JavaScriptè¿è¡Œï¼Œæ£€æµ‹å¥åº·çŠ¶æ€
     â†“
å¦‚æœæ£€æµ‹åˆ°é—®é¢˜ï¼Œåˆ‡æ¢åˆ° domain-b.com
```

#### âŒ DNSæ±¡æŸ“æƒ…å†µ
```
ç”¨æˆ·è®¿é—® domain-a.com (è¢«æ±¡æŸ“)
     â†“
DNSè§£æ: domain-a.com â†’ 5.6.7.8 (é”™è¯¯çš„IPï¼Œä¸æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨)
     â†“
è¿æ¥åˆ°é”™è¯¯çš„æœåŠ¡å™¨ (å¯èƒ½æ˜¯ç©ºé¡µé¢ã€é”™è¯¯é¡µé¢æˆ–æ¶æ„é¡µé¢)
     â†“
æˆ‘ä»¬çš„JavaScriptä»£ç æ ¹æœ¬ä¸ä¼šæ‰§è¡Œï¼
     â†“
ç”¨æˆ·è¢«"å›°ä½"ï¼Œæ— æ³•è‡ªåŠ¨åˆ‡æ¢åˆ° domain-b.com
```

---

## ğŸ› ï¸ é’ˆå¯¹DNSæ±¡æŸ“çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šé¢„é˜²æ€§éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### åœ¨ç”¨æˆ·è¿˜èƒ½æ­£å¸¸è®¿é—®æ—¶å°±éƒ¨ç½²åˆ‡æ¢é€»è¾‘

```javascript
// åœ¨æ‰€æœ‰é¡µé¢éƒ¨ç½²çš„é¢„é˜²æ€§ä»£ç 
(function() {
    // ä¸»åŸŸåæ± é…ç½®
    const PRIMARY_DOMAINS = ['domain-a.com'];
    const BACKUP_DOMAINS = ['domain-b.com', 'domain-c.net', 'domain-d.org'];
    
    // å®šæœŸæ£€æŸ¥ä¸»åŸŸåå¥åº·çŠ¶æ€
    async function checkAndPreventPollution() {
        const currentDomain = window.location.hostname;
        
        // å¦‚æœå½“å‰åœ¨ä¸»åŸŸåä¸Š
        if (PRIMARY_DOMAINS.includes(currentDomain)) {
            // æ£€æŸ¥ä¸»åŸŸåæ˜¯å¦è¿˜èƒ½æ­£å¸¸å·¥ä½œ
            const isHealthy = await checkDomainHealth(currentDomain);
            
            if (!isHealthy) {
                // ä¸»åŸŸåå‡ºç°é—®é¢˜ï¼Œç«‹å³åˆ‡æ¢åˆ°å¤‡ç”¨åŸŸå
                localStorage.setItem('primaryDomainFailed', JSON.stringify({
                    failedDomain: currentDomain,
                    timestamp: Date.now(),
                    reason: 'health_check_failed'
                }));
                
                // åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯ç”¨çš„å¤‡ç”¨åŸŸå
                await switchToFirstWorkingBackup();
            }
        }
    }
    
    async function switchToFirstWorkingBackup() {
        for (const backupDomain of BACKUP_DOMAINS) {
            if (await checkDomainHealth(backupDomain)) {
                window.location.href = `https://${backupDomain}${window.location.pathname}`;
                return;
            }
        }
    }
    
    // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    setInterval(checkAndPreventPollution, 30000);
    
    // é¡µé¢åŠ è½½æ—¶ä¹Ÿæ£€æŸ¥ä¸€æ¬¡
    setTimeout(checkAndPreventPollution, 2000);
})();
```

### æ–¹æ¡ˆ2ï¼šæ™ºèƒ½åŸŸåå…¥å£é¡µ

#### åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„åŸŸåæ£€æµ‹å’Œåˆ†å‘é¡µé¢

```html
<!-- éƒ¨ç½²åœ¨å¤šä¸ªåŸŸåä¸Šçš„å…¥å£é¡µé¢ -->
<!DOCTYPE html>
<html>
<head>
    <title>æ­£åœ¨è¿æ¥åˆ°æœ€ä½³æœåŠ¡å™¨...</title>
    <meta charset="utf-8">
</head>
<body>
    <div id="status">æ­£åœ¨æ£€æµ‹æœ€ä½³è¿æ¥...</div>
    
    <script>
    (async function() {
        const DOMAIN_POOL = [
            'domain-a.com',
            'domain-b.com', 
            'domain-c.net',
            'domain-d.org'
        ];
        
        const statusDiv = document.getElementById('status');
        
        // æ£€æµ‹æ‰€æœ‰åŸŸåï¼Œæ‰¾åˆ°æœ€å¿«çš„
        async function findBestDomain() {
            statusDiv.textContent = 'æ­£åœ¨æµ‹è¯•æ‰€æœ‰æœåŠ¡å™¨è¿æ¥...';
            
            const promises = DOMAIN_POOL.map(async (domain) => {
                const start = Date.now();
                try {
                    const response = await fetch(`https://${domain}/api/health`, {
                        method: 'HEAD',
                        cache: 'no-cache',
                        signal: AbortSignal.timeout(3000)
                    });
                    
                    if (response.ok) {
                        return {
                            domain: domain,
                            responseTime: Date.now() - start,
                            healthy: true
                        };
                    }
                } catch (error) {
                    return {
                        domain: domain,
                        responseTime: 9999,
                        healthy: false
                    };
                }
            });
            
            const results = await Promise.all(promises);
            
            // æ‰¾åˆ°æœ€å¿«çš„å¥åº·åŸŸå
            const healthyDomains = results.filter(r => r.healthy);
            if (healthyDomains.length > 0) {
                healthyDomains.sort((a, b) => a.responseTime - b.responseTime);
                return healthyDomains[0].domain;
            }
            
            return null;
        }
        
        const bestDomain = await findBestDomain();
        
        if (bestDomain) {
            statusDiv.textContent = `æ­£åœ¨è¿æ¥åˆ° ${bestDomain}...`;
            
            // ä¿å­˜æœ€ä½³åŸŸååå¥½
            localStorage.setItem('preferredDomain', bestDomain);
            localStorage.setItem('domainTestTime', Date.now());
            
            // è·³è½¬åˆ°æœ€ä½³åŸŸå
            window.location.href = `https://${bestDomain}/`;
        } else {
            statusDiv.textContent = 'æ‰€æœ‰æœåŠ¡å™¨æš‚æ—¶æ— æ³•è¿æ¥ï¼Œè¯·ç¨åé‡è¯•';
        }
    })();
    </script>
</body>
</html>
```

### æ–¹æ¡ˆ3ï¼šCloudflare DNSå±‚æ•…éšœè½¬ç§»ï¼ˆæœ€å¯é ï¼‰

#### é…ç½®Cloudflareè‡ªåŠ¨DNSåˆ‡æ¢

```yaml
Cloudflareé…ç½®:
  å¥åº·æ£€æŸ¥:
    - æ£€æŸ¥ domain-a.com/api/health
    - æ£€æŸ¥ domain-b.com/api/health
    - æ£€æŸ¥ domain-c.net/api/health
    
  æ•…éšœè½¬ç§»è§„åˆ™:
    å½“ domain-a.com å¥åº·æ£€æŸ¥å¤±è´¥æ—¶:
      è‡ªåŠ¨å°† DNS è§£æåˆ‡æ¢åˆ° domain-b.com
      
    å½“ domain-b.com ä¹Ÿå¤±è´¥æ—¶:
      è‡ªåŠ¨åˆ‡æ¢åˆ° domain-c.net
```

**å…³é”®ä¼˜åŠ¿ï¼š**
- DNSå±‚é¢çš„åˆ‡æ¢ï¼Œä¸ä¾èµ–JavaScript
- å³ä½¿ä¸»åŸŸåè¢«æ±¡æŸ“ï¼Œå¤‡ç”¨åŸŸåä»ç„¶å¯ä»¥æ­£å¸¸è§£æ
- å…¨çƒç”Ÿæ•ˆæ—¶é—´ï¼š1-5åˆ†é’Ÿ

### æ–¹æ¡ˆ4ï¼šæœ¬åœ°åº”ç”¨/æµè§ˆå™¨æ’ä»¶ï¼ˆé«˜çº§æ–¹æ¡ˆï¼‰

#### å¼€å‘ç‹¬ç«‹çš„åŸŸåç®¡ç†å·¥å…·

```javascript
// æµè§ˆå™¨æ’ä»¶æˆ–æœ¬åœ°åº”ç”¨
class DomainManager {
    constructor() {
        this.domains = [
            'domain-a.com',
            'domain-b.com',
            'domain-c.net'
        ];
    }
    
    // åœ¨ç”¨æˆ·è®¿é—®ä»»ä½•åŸŸåå‰ï¼Œå…ˆæ£€æµ‹å¯ç”¨æ€§
    async redirectToWorkingDomain(targetUrl) {
        const urlObj = new URL(targetUrl);
        const targetDomain = urlObj.hostname;
        
        // å¦‚æœç›®æ ‡åŸŸåå¯ç”¨ï¼Œç›´æ¥è®¿é—®
        if (await this.checkDomain(targetDomain)) {
            return targetUrl;
        }
        
        // å¦åˆ™æ‰¾åˆ°å¯ç”¨çš„åŸŸåå¹¶é‡å†™URL
        for (const domain of this.domains) {
            if (await this.checkDomain(domain)) {
                urlObj.hostname = domain;
                return urlObj.toString();
            }
        }
        
        throw new Error('æ‰€æœ‰åŸŸåéƒ½ä¸å¯ç”¨');
    }
}
```

---

## ğŸ¯ æ¨èçš„ç»¼åˆè§£å†³æ–¹æ¡ˆ

### å¤šå±‚é˜²æŠ¤ç­–ç•¥

#### ç¬¬ä¸€å±‚ï¼šé¢„é˜²æ€§JavaScriptéƒ¨ç½²
```javascript
// åœ¨ç”¨æˆ·è¿˜èƒ½æ­£å¸¸è®¿é—®æ—¶å°±éƒ¨ç½²
// å®šæœŸæ£€æŸ¥ä¸»åŸŸåï¼Œå‘ç°é—®é¢˜ç«‹å³åˆ‡æ¢
```

#### ç¬¬äºŒå±‚ï¼šCloudflare DNSæ•…éšœè½¬ç§»
```yaml
# ä¸“ä¸šDNSæœåŠ¡ï¼Œæ— éœ€JavaScript
# ä¸»åŸŸåå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢DNSè§£æ
```

#### ç¬¬ä¸‰å±‚ï¼šæ™ºèƒ½å…¥å£é¡µ
```html
<!-- å¤šä¸ªåŸŸåéƒ½éƒ¨ç½²ç›¸åŒçš„æ£€æµ‹é¡µé¢ -->
<!-- ç”¨æˆ·ä»ä»»ä½•åŸŸåè¿›å…¥éƒ½èƒ½æ‰¾åˆ°æœ€ä½³è¿æ¥ -->
```

#### ç¬¬å››å±‚ï¼šç”¨æˆ·æ•™è‚²å’Œå¤‡ç”¨è®¿é—®æ–¹å¼
```yaml
ç”¨æˆ·æŒ‡å¯¼:
  - æä¾›å¤šä¸ªå¤‡ç”¨åŸŸå
  - æ•™ç”¨æˆ·æ”¶è—å¤‡ç”¨åŸŸå
  - æä¾›QRç æˆ–çŸ­é“¾æ¥
```

---

## ğŸ§ª å®é™…æµ‹è¯•éªŒè¯

### æ¨¡æ‹ŸDNSæ±¡æŸ“æµ‹è¯•

```bash
# æ¨¡æ‹ŸAåŸŸåè¢«æ±¡æŸ“
sudo echo "127.0.0.1 domain-a.com" >> /etc/hosts

# æµ‹è¯•ç”¨æˆ·è®¿é—®AåŸŸåçš„è¡Œä¸º
curl -v http://domain-a.com
# é¢„æœŸï¼šè¿æ¥åˆ°127.0.0.1ï¼Œæ— æ³•åˆ°è¾¾æˆ‘ä»¬çš„æœåŠ¡å™¨

# æµ‹è¯•BåŸŸåæ˜¯å¦æ­£å¸¸
curl -v http://domain-b.com  
# é¢„æœŸï¼šæ­£å¸¸è¿æ¥åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨
```

### æ•…éšœè½¬ç§»æµ‹è¯•æµç¨‹

```yaml
æµ‹è¯•æ­¥éª¤:
  1. éƒ¨ç½²å¤šåŸŸååˆ‡æ¢ä»£ç åˆ°æ‰€æœ‰åŸŸå
  2. æ¨¡æ‹Ÿä¸»åŸŸåDNSæ±¡æŸ“
  3. è§‚å¯Ÿç”¨æˆ·æ˜¯å¦èƒ½é€šè¿‡å¤‡ç”¨åŸŸåæ­£å¸¸è®¿é—®
  4. æµ‹è¯•Cloudflare DNSæ•…éšœè½¬ç§»åŠŸèƒ½
  5. éªŒè¯ç”¨æˆ·çŠ¶æ€ä¿æŒå’Œæ¢å¤
```

---

## âœ… ç»“è®ºå’Œæœ€ä½³å®è·µ

### ç›´æ¥å›ç­”æ‚¨çš„é—®é¢˜ï¼š

**âŒ å•çº¯çš„JavaScriptæ–¹æ¡ˆä¸èƒ½è§£å†³DNSæ±¡æŸ“é—®é¢˜**
- å¦‚æœAåŸŸåè¢«æ±¡æŸ“ï¼Œç”¨æˆ·è¿æ¥åˆ°é”™è¯¯æœåŠ¡å™¨
- æˆ‘ä»¬çš„JavaScriptä»£ç ä¸ä¼šæ‰§è¡Œ
- æ— æ³•è‡ªåŠ¨é‡å®šå‘åˆ°BåŸŸå

**âœ… éœ€è¦å¤šå±‚é˜²æŠ¤æ‰èƒ½çœŸæ­£è§£å†³**
1. **é¢„é˜²æ€§éƒ¨ç½²**ï¼šåœ¨æ±¡æŸ“å‘ç”Ÿå‰å°±éƒ¨ç½²åˆ‡æ¢é€»è¾‘
2. **DNSå±‚æ•…éšœè½¬ç§»**ï¼šä½¿ç”¨Cloudflareä¸“ä¸šæœåŠ¡
3. **å¤šåŸŸåå…¥å£**ï¼šæ¯ä¸ªåŸŸåéƒ½éƒ¨ç½²æ£€æµ‹é¡µé¢
4. **ç”¨æˆ·æ•™è‚²**ï¼šæä¾›å¤šä¸ªè®¿é—®æ–¹å¼

### æœ€æœ‰æ•ˆçš„æ–¹æ¡ˆç»„åˆï¼š

```yaml
æ¨èé…ç½®:
  ä¸»è¦ç­–ç•¥: Cloudflare DNSæ•…éšœè½¬ç§» (æœ€å¯é )
  è¾…åŠ©ç­–ç•¥: é¢„é˜²æ€§JavaScriptéƒ¨ç½² (æœ€å¿«å“åº”)
  å¤‡ç”¨ç­–ç•¥: æ™ºèƒ½å…¥å£é¡µé¢ (ç”¨æˆ·è‡ªæ•‘)
  åº”æ€¥ç­–ç•¥: å¤šæ¸ é“é€šçŸ¥ç”¨æˆ·å¤‡ç”¨åŸŸå
```

**è¦å®ç°çœŸæ­£çš„æŠ—æ±¡æŸ“èƒ½åŠ›ï¼Œéœ€è¦åœ¨DNSå±‚é¢åšæ•…éšœè½¬ç§»ï¼Œè€Œä¸èƒ½ä»…ä¾èµ–JavaScriptï¼** ğŸ¯

è¦ä¸è¦æˆ‘å¸®æ‚¨é…ç½®Cloudflareçš„DNSå±‚æ•…éšœè½¬ç§»ï¼Ÿè¿™æ˜¯æœ€å¯é çš„è§£å†³æ–¹æ¡ˆï¼ 